Starting Application using Java 17 with PID 22932 (D:\workspace\message-consumer\build\classes\java\main started by jaebu in D:\workspace\message-consumer)
The following 1 profile is active: "deploy"
처리되지 않은 메시지 정리 중...
처리되지 않은 메시지 없음
메시지 스트림 모니터 초기화 중... 소비자 ID: chat-message-processor-1024c28d9-f7c9-4411-9c9f-6ad635d47c9f
Stream 'chat:stream:messages' 정보: 항목 수: 242
  첫 번째 항목 ID: 1747639128211-0, 마지막 항목 ID: 1747667340432-0
소비자 그룹 'chat-message-processors' 정보: 처리되지 않은 메시지 총 개수: 0
Redis Stream 복원 관리자 초기화 중...
Stream 메시지 리스너 컨테이너 시작됨
컨슈머 그룹 'chat-message-processors' 이미 존재함
Started Application in 5.647 seconds (process running for 6.293)
Redis Stream에서 새 메시지 수신 - 스트림: chat:stream:messages, ID: 1747668847405-0

    select
        count(*) 
    from
        chat_messages cm1_0 
    where
        cm1_0.message_id=?
메시지 처리 시작 - ID: adc213b5-33bf-4a84-84cb-fc80e9d0f1cc, 채팅방: test-room-1, 타입: CHAT

    select
        cm1_0.message_id,
        cm1_0.content,
        cm1_0.processed,
        cm1_0.processed_at,
        cm1_0.retry_count,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.type 
    from
        chat_messages cm1_0 
    where
        cm1_0.message_id=?
메시지 저장 완료 - ID: adc213b5-33bf-4a84-84cb-fc80e9d0f1cc
메시지가 STOMP로 전달됨 - 대상: /topic/public/test-room-1, ID: adc213b5-33bf-4a84-84cb-fc80e9d0f1cc, 타입: CHAT

    insert 
    into
        chat_messages
        (content, processed, processed_at, retry_count, room_id, sender, timestamp, type, message_id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?)
메시지 처리 완료 - ID: 1747668847405-0
Redis Stream에서 새 메시지 수신 - 스트림: chat:stream:messages, ID: 1747669375780-0

    select
        count(*) 
    from
        chat_messages cm1_0 
    where
        cm1_0.message_id=?
메시지 처리 시작 - ID: 726a2a6f-0668-4e57-9fd3-307f9797282e, 채팅방: test-room-1, 타입: JOIN

    select
        cm1_0.message_id,
        cm1_0.content,
        cm1_0.processed,
        cm1_0.processed_at,
        cm1_0.retry_count,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.type 
    from
        chat_messages cm1_0 
    where
        cm1_0.message_id=?
메시지 저장 완료 - ID: 726a2a6f-0668-4e57-9fd3-307f9797282e
메시지가 STOMP로 전달됨 - 대상: /topic/public/test-room-1, ID: 726a2a6f-0668-4e57-9fd3-307f9797282e, 타입: JOIN

    insert 
    into
        chat_messages
        (content, processed, processed_at, retry_count, room_id, sender, timestamp, type, message_id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?)
메시지 처리 완료 - ID: 1747669375780-0
Redis Stream에서 새 메시지 수신 - 스트림: chat:stream:messages, ID: 1747671150834-0

    select
        count(*) 
    from
        chat_messages cm1_0 
    where
        cm1_0.message_id=?
메시지 처리 시작 - ID: f493dbaa-a577-4844-9e7f-8faa04d036c2, 채팅방: test-room-1, 타입: JOIN

    select
        cm1_0.message_id,
        cm1_0.content,
        cm1_0.processed,
        cm1_0.processed_at,
        cm1_0.retry_count,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.type 
    from
        chat_messages cm1_0 
    where
        cm1_0.message_id=?
메시지 저장 완료 - ID: f493dbaa-a577-4844-9e7f-8faa04d036c2
메시지가 STOMP로 전달됨 - 대상: /topic/public/test-room-1, ID: f493dbaa-a577-4844-9e7f-8faa04d036c2, 타입: JOIN

    insert 
    into
        chat_messages
        (content, processed, processed_at, retry_count, room_id, sender, timestamp, type, message_id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?)
메시지 처리 완료 - ID: 1747671150834-0
Redis Stream에서 새 메시지 수신 - 스트림: chat:stream:messages, ID: 1747671182283-0

    select
        count(*) 
    from
        chat_messages cm1_0 
    where
        cm1_0.message_id=?
메시지 처리 시작 - ID: 1ddb5a49-b241-4e6c-8344-eab8ba7e9e35, 채팅방: test-room-1, 타입: JOIN

    select
        cm1_0.message_id,
        cm1_0.content,
        cm1_0.processed,
        cm1_0.processed_at,
        cm1_0.retry_count,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.type 
    from
        chat_messages cm1_0 
    where
        cm1_0.message_id=?
메시지 저장 완료 - ID: 1ddb5a49-b241-4e6c-8344-eab8ba7e9e35
메시지가 STOMP로 전달됨 - 대상: /topic/public/test-room-1, ID: 1ddb5a49-b241-4e6c-8344-eab8ba7e9e35, 타입: JOIN

    insert 
    into
        chat_messages
        (content, processed, processed_at, retry_count, room_id, sender, timestamp, type, message_id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?)
메시지 처리 완료 - ID: 1747671182283-0
Redis Stream에서 새 메시지 수신 - 스트림: chat:stream:messages, ID: 1747671184373-0

    select
        count(*) 
    from
        chat_messages cm1_0 
    where
        cm1_0.message_id=?
메시지 처리 시작 - ID: eb5b090c-cae5-4c2c-8e9e-37e6cfbb3b90, 채팅방: test-room-1, 타입: CHAT

    select
        cm1_0.message_id,
        cm1_0.content,
        cm1_0.processed,
        cm1_0.processed_at,
        cm1_0.retry_count,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.type 
    from
        chat_messages cm1_0 
    where
        cm1_0.message_id=?
메시지 저장 완료 - ID: eb5b090c-cae5-4c2c-8e9e-37e6cfbb3b90
메시지가 STOMP로 전달됨 - 대상: /topic/public/test-room-1, ID: eb5b090c-cae5-4c2c-8e9e-37e6cfbb3b90, 타입: CHAT

    insert 
    into
        chat_messages
        (content, processed, processed_at, retry_count, room_id, sender, timestamp, type, message_id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?)
메시지 처리 완료 - ID: 1747671184373-0
Redis Stream에서 새 메시지 수신 - 스트림: chat:stream:messages, ID: 1747671268041-0

    select
        count(*) 
    from
        chat_messages cm1_0 
    where
        cm1_0.message_id=?
메시지 처리 시작 - ID: b161a880-b1c5-4f94-8c96-a85de8c8884f, 채팅방: test-room-1, 타입: JOIN

    select
        cm1_0.message_id,
        cm1_0.content,
        cm1_0.processed,
        cm1_0.processed_at,
        cm1_0.retry_count,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.type 
    from
        chat_messages cm1_0 
    where
        cm1_0.message_id=?
메시지 저장 완료 - ID: b161a880-b1c5-4f94-8c96-a85de8c8884f
메시지가 STOMP로 전달됨 - 대상: /topic/public/test-room-1, ID: b161a880-b1c5-4f94-8c96-a85de8c8884f, 타입: JOIN

    insert 
    into
        chat_messages
        (content, processed, processed_at, retry_count, room_id, sender, timestamp, type, message_id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?)
메시지 처리 완료 - ID: 1747671268041-0
Redis Stream에서 새 메시지 수신 - 스트림: chat:stream:messages, ID: 1747671283470-0

    select
        count(*) 
    from
        chat_messages cm1_0 
    where
        cm1_0.message_id=?
메시지 처리 시작 - ID: 08a9cd0a-05cb-46e9-b269-4c4a68f63be0, 채팅방: test-room-1, 타입: CHAT

    select
        cm1_0.message_id,
        cm1_0.content,
        cm1_0.processed,
        cm1_0.processed_at,
        cm1_0.retry_count,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.type 
    from
        chat_messages cm1_0 
    where
        cm1_0.message_id=?
메시지 저장 완료 - ID: 08a9cd0a-05cb-46e9-b269-4c4a68f63be0
메시지가 STOMP로 전달됨 - 대상: /topic/public/test-room-1, ID: 08a9cd0a-05cb-46e9-b269-4c4a68f63be0, 타입: CHAT

    insert 
    into
        chat_messages
        (content, processed, processed_at, retry_count, room_id, sender, timestamp, type, message_id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?)
메시지 처리 완료 - ID: 1747671283470-0
Unexpected error occurred in scheduled task
org.springframework.data.redis.RedisSystemException: Redis exception
	at org.springframework.data.redis.connection.lettuce.LettuceExceptionConverter.convert(LettuceExceptionConverter.java:72)
	at org.springframework.data.redis.connection.lettuce.LettuceExceptionConverter.convert(LettuceExceptionConverter.java:41)
	at org.springframework.data.redis.PassThroughExceptionTranslationStrategy.translate(PassThroughExceptionTranslationStrategy.java:40)
	at org.springframework.data.redis.FallbackExceptionTranslationStrategy.translate(FallbackExceptionTranslationStrategy.java:38)
	at org.springframework.data.redis.connection.lettuce.LettuceConnection.convertLettuceAccessException(LettuceConnection.java:306)
	at org.springframework.data.redis.connection.lettuce.LettuceConnection.await(LettuceConnection.java:1010)
	at org.springframework.data.redis.connection.lettuce.LettuceConnection.lambda$doInvoke$3(LettuceConnection.java:443)
	at org.springframework.data.redis.connection.lettuce.LettuceInvoker$Synchronizer.invoke(LettuceInvoker.java:673)
	at org.springframework.data.redis.connection.lettuce.LettuceInvoker$DefaultManyInvocationSpec.toList(LettuceInvoker.java:618)
	at org.springframework.data.redis.connection.lettuce.LettuceStreamCommands.xReadGroup(LettuceStreamCommands.java:282)
	at org.springframework.data.redis.stream.DefaultStreamMessageListenerContainer.lambda$getReadFunction$3(DefaultStreamMessageListenerContainer.java:236)
	at org.springframework.data.redis.core.RedisTemplate.execute(RedisTemplate.java:396)
	at org.springframework.data.redis.core.RedisTemplate.execute(RedisTemplate.java:363)
	at org.springframework.data.redis.core.RedisTemplate.execute(RedisTemplate.java:350)
	at org.springframework.data.redis.stream.DefaultStreamMessageListenerContainer.lambda$getReadFunction$4(DefaultStreamMessageListenerContainer.java:235)
	at org.springframework.data.redis.stream.StreamPollTask.readRecords(StreamPollTask.java:146)
	at org.springframework.data.redis.stream.StreamPollTask.doLoop(StreamPollTask.java:127)
	at org.springframework.data.redis.stream.StreamPollTask.run(StreamPollTask.java:112)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: io.lettuce.core.RedisException: Connection closed
	at io.lettuce.core.protocol.DefaultEndpoint.lambda$notifyDrainQueuedCommands$7(DefaultEndpoint.java:679)
	at io.lettuce.core.protocol.DefaultEndpoint$Lazy.getNullable(DefaultEndpoint.java:1167)
	at io.lettuce.core.protocol.DefaultEndpoint$Lazy.get(DefaultEndpoint.java:1152)
	at io.lettuce.core.protocol.DefaultEndpoint.lambda$notifyDrainQueuedCommands$8(DefaultEndpoint.java:680)
	at io.lettuce.core.protocol.DefaultEndpoint.cancelCommands(DefaultEndpoint.java:786)
	at io.lettuce.core.protocol.DefaultEndpoint.notifyDrainQueuedCommands(DefaultEndpoint.java:680)
	at io.lettuce.core.protocol.CommandHandler.channelInactive(CommandHandler.java:358)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:303)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:281)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelInactive(AbstractChannelHandlerContext.java:274)
	at io.netty.channel.ChannelInboundHandlerAdapter.channelInactive(ChannelInboundHandlerAdapter.java:81)
	at io.lettuce.core.protocol.RedisHandshakeHandler.channelInactive(RedisHandshakeHandler.java:94)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:303)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:281)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelInactive(AbstractChannelHandlerContext.java:274)
	at io.netty.channel.ChannelInboundHandlerAdapter.channelInactive(ChannelInboundHandlerAdapter.java:81)
	at io.lettuce.core.ChannelGroupListener.channelInactive(ChannelGroupListener.java:69)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:303)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:281)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelInactive(AbstractChannelHandlerContext.java:274)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelInactive(DefaultChannelPipeline.java:1405)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:301)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:281)
	at io.netty.channel.DefaultChannelPipeline.fireChannelInactive(DefaultChannelPipeline.java:901)
	at io.netty.channel.AbstractChannel$AbstractUnsafe$7.run(AbstractChannel.java:813)
	at io.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:173)
	at io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:166)
	at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:470)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:569)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	... 1 common frames omitted
Redis Stream 복원 관리자 정리 중...
